---
title: "Manuscript_4_Data_Analysis_directory_RBRA"
author: "Rita H. R. Branco"
date: "4/24/2023"
output: html_document
---

This is an R Markdown document contains an analysis of micropollutant removal, microbial activity and gene presence of an experiment of Rita H.R. Branco.

## Install packages

```{r import data, message=F, echo=T, eval=T, warning=F, include=T, cache=F}
setwd("C:/Users/Rita/Documents/R/amendment_micropollutant_biodegradation_aquifer") #set working directory

knitr::opts_chunk$set(echo = TRUE)

options(scipen = 999) # tell R to avoid all scientific notation

# Package list
packages <- c("rmarkdown", "readxl", "reshape2", "dplyr", "scales", "ggh4x", "RColorBrewer", "cowplot", "ggbreak", "ggnewscale", "ggplot2", "stringr")

# Install packages not yet installed
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Load packages
library(rmarkdown)
library(readxl) 
library(reshape2)
library(dplyr)
library(scales)
library(ggh4x)
library(RColorBrewer)
library(cowplot)
library(ggbreak)
library(ggnewscale)
library(ggplot2)
library(stringr)
```

# 1. Loading, exploring and treating the data

## 1.1. Oxygen data

### 1.1.1. Define the class of each column
```{r 1.1.1. class of each column, message=F, echo=T, eval=T, warning=F, include=T, cache=F}
all_data_NA <- read_excel("C:/Users/Rita/Documents/R/amendment_micropollutant_biodegradation_aquifer/input_data/Manuscript_4_oxygen.xlsx", col_types = c("text", "text", "text", "text", "numeric", "text", "numeric"))
```

### 1.1.2. Removing NA data
```{r 1.1.2. NA removal, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
all_data <- na.omit(all_data_NA)
```

### 1.1.3. Reordering data (reordering facets of facet plot using relevel function)
```{r 1.1.3. reorder, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
data_ordered <- all_data
data_ordered$Column <- factor(data_ordered$Column, levels = c("Nitrate_red_Microaer", "Nitrate_red", "Aerob", "Aerob_Microaer"))
data_ordered$DOC <- factor(data_ordered$DOC, levels = c("none", "H", "H_D", "D", "D_A", "A", "NH4"))
data_ordered$Height <- factor(data_ordered$Height, levels = c("0", "2.5", "6.25", "10", "13.75", "17.5", "25", "32.5", "47.5"))
```

### 1.1.4. Data per column
```{r 1.1.4. data per column, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
#Nitrate_red_Microaer
nitrate_red_microaer_O2 <- data_ordered %>% filter(Column == "Nitrate_red_Microaer")

#Nitrate_red 
nitrate_red_O2 <- data_ordered %>% filter(Column == "Nitrate_red")

#Aerob 
aerob_O2 <- data_ordered %>% filter(Column == "Aerob")

#Aerob_Microaer
aerob_microaerob_O2 <- data_ordered %>% filter(Column == "Aerob_Microaer")
```

## 1.2. Remaining chemical and qPCR data

### 1.2.1. Define the class of each column
```{r 1.2.1. class of each column, message=F, echo=T, eval=T, warning=F, include=T, cache=F}
all_data_chem_short <- read_excel("C:/Users/Rita/Documents/R/amendment_micropollutant_biodegradation_aquifer/input_data/Manuscript_4_data.xlsx", col_types = c("text", "text", "text", "text", "numeric", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"))
```

### 1.2.2. Creating a compound column and respective concentration
```{r 1.2.2. compound concentration, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
all_data_chem_NA = melt(all_data_chem_short, id.vars = c("Column", "DOM", "Day", "Group","Height", "Redox_condition_2_50", "Aeration"), 
                 variable.name = "compound", value.name = "concentration")
```

### 1.2.3. Removing NA data
```{r 1.2.3. NA removal, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
all_data_chem <- na.omit(all_data_chem_NA)
```

### 1.2.4. Reordering data (reordering facets of facet plot using relevel function)
```{r 1.2.4. reorder, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
data_chem_ordered <- all_data_chem
data_chem_ordered$Column <- factor(data_chem_ordered$Column, levels = c("Nitrate_red_Microaer", "Nitrate_red", "Aerob", "Aerob_Microaer"))
data_chem_ordered$DOM <- factor(data_chem_ordered$DOM, levels = c("none", "H", "H_D", "D", "D_A", "A", "NH4"))
data_chem_ordered$Height <- factor(data_chem_ordered$Height, levels = c("0", "2.5", "17.5", "32.5", "47.5", "50"))
data_chem_ordered$compound <- factor(data_chem_ordered$compound, levels = c("24_D", "MCPP", "CLZ", "CLZ_DP", "CLZ_MDP", "DCB", "BAM", "MET_ESA", "MET_OA", "BTZ", "ANP", "CBZ", "GAB", "ACK", "1H_BTR", "HUM", "BIOPOL", "ACET","LMWA", "LMWN", "HOC", "CDOC", "DOC", "NH4", "NO3", "NO2", "16S_bac", "tfdA_87_88", "tfdA_95_96", "tfdA_total", "nirK", "nirS", "amoA"))
```

### 1.2.5. Keeping only micropollutants removed
```{r 1.2.5. keep MP removed, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
#micropollutants removed
data_micropol <- data_chem_ordered %>% filter(compound == "24_D" | compound == "MCPP")

#2,4-D
data_24_D <- data_chem_ordered %>% filter(compound == "24_D")
nitrate_red_microaer_24_D <- data_24_D %>% filter(Column == "Nitrate_red_Microaer")
nitrate_red_24_D <- data_24_D %>% filter(Column == "Nitrate_red")
aerob_24_D <- all_data_chem_NA %>% filter(compound == "24_D" & Column == "Aerob" & !Day == -34 & !Day == 14 & !Day == 42 & !Day == 70 & !Day == 98 & !Day == 126)
aerob_microaerob_24_D <- all_data_chem_NA %>% filter(compound == "24_D" & Column == "Aerob_Microaer" & !Day == -34)

#MCPP
data_MCPP <- data_chem_ordered %>% filter(compound == "MCPP")
nitrate_red_microaer_MCPP <- data_MCPP %>% filter(Column == "Nitrate_red_Microaer")
nitrate_red_MCPP <- data_MCPP %>% filter(Column == "Nitrate_red")
aerob_MCPP <- all_data_chem_NA %>% filter(compound == "MCPP" & Column == "Aerob" & !Day == -34 & !Day == 14 & !Day == 42 & !Day == 70 & !Day == 98 & !Day == 126)
aerob_microaerob_MCPP <- data_MCPP %>% filter(Column == "Aerob_Microaer")
```

### 1.2.6. Keeping only nitrate
```{r 1.2.6. keep NO3 data, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
#NO3
data_NO3 <- data_chem_ordered %>% filter(compound == "NO3")
nitrate_red_microaer_NO3 <- data_NO3 %>% filter(Column == "Nitrate_red_Microaer")
nitrate_red_NO3 <- data_NO3 %>% filter(Column == "Nitrate_red")
aerob_NO3 <- data_NO3 %>% filter(Column == "Aerob")
aerob_microaerob_NO3 <- data_NO3 %>% filter(Column == "Aerob_Microaer")
```

### 1.2.7. Keeping only e- donor
```{r 1.2.7. keep e- donor, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
#DOC added
data_donor <- data_chem_ordered %>% filter((compound == "HUM" | compound == "BIOPOL"| compound ==  "NH4" | compound == "LMWA" | compound == "LMWN" | compound == "HOC") & !Height == "0")
nitrate_red_microaer_donor <- data_donor %>% filter(Column == "Nitrate_red_Microaer")
nitrate_red_donor <- data_donor %>% filter(Column == "Nitrate_red")
aerob_donor <- data_donor %>% filter(Column == "Aerob")
aerob_microaerob_donor <- data_donor %>% filter(Column == "Aerob_Microaer")
```

## 1.3. Removal efficiency

### 1.3.1. Define the class of each column
```{r 1.3.1. class of each column, message=F, echo=T, eval=T, warning=F, include=T, cache=F}
heatmap_short <- read_excel("C:/Users/Rita/Documents/R/amendment_micropollutant_biodegradation_aquifer/input_data/Manuscript_4_removal_efficiency.xlsx", col_types = c("text", "text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"))
```

### 1.3.2. Creating a compound column and respective removal efficiency column
```{r 1.3.2. compound removal efficiency, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
heatmap_long = melt(heatmap_short, id.vars = c("Column", "DOC", "Redox_condition_2_50", "Aeration", "Day", "Day0", "Daymax", "Height", "Height0", "Heightf"), 
                 variable.name = "Compound", value.name = "Removal_Efficiency")
```

### 1.3.3. Reordering data
```{r 1.3.3. data reorder, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
heatmap_ordered <- heatmap_long
heatmap_ordered$Column <- factor(heatmap_ordered$Column, levels = c("Nitrate_red_Microaer", "Nitrate_red", "Aerob", "Aerob_Microaer"))
heatmap_ordered$DOC <- factor(heatmap_ordered$DOC, levels = c("none", "H", "H_D", "D", "D_A", "A", "NH4"))
heatmap_ordered$Compound <- factor(heatmap_ordered$Compound, levels = c("24_D", "MCPP", "CLZ", "CLZ_DP", "CLZ_MDP", "DCB", "BAM", "MET_ESA", "MET_OA", "BTZ", "ANP", "CBZ", "GAB", "ACK", "1H_BTR"))
```

### 1.3.4. Reoordering y axis and creat new variables for removal efficiency
```{r 1.3.4. y axis reorder, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
round0 <- function(x) ifelse(abs(x) < 1.0, format(round(x, 2), nsmall = 1, justify = "centre"), ifelse(abs(x) < 10.0, format(round(x, 1), nsmall = 1, justify = "centre"), round(x, 0)))

heatmap_final <- heatmap_ordered %>%
      mutate(RemovalEf = round0(Removal_Efficiency)) %>%
  mutate_if(is.character, str_replace_all, ' ', '')
```

### 1.3.5. Separating MP biodegraded
```{r 1.3.5. separate MP biodegraded, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
#2,4-D
heatmap_NM_24_D <- heatmap_final %>%
  filter(Compound == "24_D" & Column == "Nitrate_red_Microaer")

heatmap_A_24_D <- heatmap_final %>%
  filter(Compound == "24_D" & Column == "Aerob")

heatmap_AM_24_D <- heatmap_final %>%
  filter(Compound == "24_D" & Column == "Aerob_Microaer")

#MCPP
heatmap_NM_MCPP <- heatmap_final %>%
  filter(Compound == "MCPP" & Column == "Nitrate_red_Microaer")

heatmap_A_MCPP <- heatmap_final %>%
  filter(Compound == "MCPP" & Column == "Aerob")

heatmap_AM_MCPP <- heatmap_final %>%
  filter(Compound == "MCPP" & Column == "Aerob_Microaer")
```

## 1.4. Oxygen copnsumption

### 1.4.1. Define the class of each column
```{r 1.4.1. class of each column, message=F, echo=T, eval=T, warning=F, include=T, cache=F}
heatmap_O2 <- read_excel("C:/Users/Rita/Documents/R/amendment_micropollutant_biodegradation_aquifer/input_data/Manuscript_4_oxygen_removal.xlsx", col_types = c("text", "text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"))
```

### 1.4.2. Reordering data
```{r 1.4.2. data reorder, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
heatmap_ordered_O2 <- heatmap_O2
heatmap_ordered_O2$Column <- factor(heatmap_ordered_O2$Column, levels = c("Nitrate_red_Microaer", "Nitrate_red", "Aerob", "Aerob_Microaer"))
heatmap_ordered_O2$DOC <- factor(heatmap_ordered_O2$DOC, levels = c("none", "H", "H_D", "D", "D_A", "A", "NH4"))
```

### 1.4.3. Reoordering y axis and creat new variables for removal efficiency
```{r 1.4.3. y axis reorder, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
round0 <- function(x) ifelse(abs(x) < 1.0, format(round(x, 2), nsmall = 1, justify = "centre"), ifelse(abs(x) < 10.0, format(round(x, 1), nsmall = 1, justify = "centre"), round(x, 0)))

heatmap_final_O2 <- heatmap_ordered_O2 %>%
      mutate(RemovalEf = round0(O2_remov)) %>%
  mutate_if(is.character, str_replace_all, ' ', '')
```

### 1.4.4. Separating O2 per column
```{r 1.4.4. Separating O2 per column, message=F, echo=T, eval=T, warning=T, include=T, cache=F}
heatmap_NM_O2 <- heatmap_final_O2 %>%
  filter(Column == "Nitrate_red_Microaer")

heatmap_A_O2 <- heatmap_final_O2 %>%
  filter(Column == "Aerob")

heatmap_AM_O2 <- heatmap_final_O2 %>%
  filter(Column == "Aerob_Microaer")

influent <- heatmap_final_O2 %>%
  na.omit()

influent_NM <- influent %>%
  filter(Column == "Nitrate_red_Microaer")

influent_A <- influent %>%
  filter(Column == "Aerob")

influent_AM <- influent %>%
  filter(Column == "Aerob_Microaer")
```

# 2. Results

## 2.1. Figure 2
```{r Figure 2, message=F, echo=T, eval=T, warning=T, include=T, cache=F, fig.width=20, fig.height=8}
#row 1
d=data.frame(x1=c(-1), x2=c(156), y1=c(0), y2=(1), r=c('Microaerobic cycles without e- donor'))

plot_1_1 <- ggplot() +
  geom_rect(data=d, mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2), color="white", fill = "white", linewidth = 0.2) +
  geom_text(data=d, aes(x=x1+(x2-x1)/2, y=y1+(y2-y1)/2, label=r), size=4) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = "Col") +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_line(size = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "white", 
                                    fill = NA, 
                                    size = 0.5),
        panel.grid.major = element_blank())

d=data.frame(x1=c(-1), x2=c(156), y1=c(0), y2=(1), r=c('Aerobic with e- donor'))

plot_1_2 <- ggplot() +
  geom_rect(data=d, mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2), color="white", fill = "white", linewidth = 0.2) +
  geom_text(data=d, aes(x=x1+(x2-x1)/2, y=y1+(y2-y1)/2, label=r), size=4) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = "Col") +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_line(size = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "white", 
                                    fill = NA, 
                                    size = 0.5),
        panel.grid.major = element_blank())

d=data.frame(x1=c(-1), x2=c(156), y1=c(0), y2=(1), r=c('Aerobic cycles with e- donor'))

plot_1_3 <- ggplot() +
  geom_rect(data=d, mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2), color="white", fill = "white", linewidth = 0.2) +
  geom_text(data=d, aes(x=x1+(x2-x1)/2, y=y1+(y2-y1)/2, label=r), size=4) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = "Col") +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_line(size = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "white", 
                                    fill = NA, 
                                    size = 0.5),
        panel.grid.major = element_blank())

row_1 <- plot_grid(plot_1_1 + theme(legend.position="none"),
                   NULL,
                   plot_1_2 + theme(legend.position="none", ),
                   NULL,
                   plot_1_3 + theme(legend.position="none"),
                   nrow = 1,
                   ncol = 5,
                   align = "v",
                   axis = "l",
                   labels = c("A", "", "B", "", "C"),
                   rel_widths = c(1,0.02,1,0.02,1))

#row 2
d=data.frame(x1=c(-1,26,103.5,117,135,143), x2=c(26,103.5,117,135,143,156), y1=c(0), y2=(1), r=c('Nitrate red','Microaer','Nitrate','Microaer','Nitrate', 'Micro'))

plot_2_1 <- ggplot() +
  geom_rect(data=d, mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2), color="black", fill = "white", linewidth = 0.2) +
  geom_text(data=d, aes(x=x1+(x2-x1)/2, y=y1+(y2-y1)/2, label=r), size=2.5) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = "RC") +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_line(size = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    size = 0.5),
        panel.grid.major = element_blank())

d=data.frame(x1=c(-1,14.5,42.5,70.5,98.5,126.5), x2=c(14.5,42.5,70.5,98.5,126.5,156), y1=c(0), y2=(1), r=c('Humics.','Humics:Dextran','Dextran','Dextran:Acetate','Acetate', 'Ammonium'))

plot_2_2 <- ggplot() +
  geom_rect(data=d, mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2), color="black", fill = "white", linewidth = 0.2) +
  geom_text(data=d, aes(x=x1+(x2-x1)/2, y=y1+(y2-y1)/2, label=r), size=2.5) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = "e-d") +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_line(size = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    size = 0.5),
        panel.grid.major = element_blank())

d=data.frame(x1=c(-1,14.5,42.5,70.5,98.5,126.5), x2=c(14.5,42.5,70.5,98.5,126.5,156), y1=c(0), y2=(1), r=c('Humics.','Humics:Dextran','Dextran','Dextran:Acetate','Acetate', 'Ammonium'))

plot_2_3 <- ggplot() +
  geom_rect(data=d, mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2), color="black", fill = "white", linewidth = 0.2) +
  geom_text(data=d, aes(x=x1+(x2-x1)/2, y=y1+(y2-y1)/2, label=r), size=2.5) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = "e-d") +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_line(size = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    size = 0.5),
        panel.grid.major = element_blank())

row_2 <- plot_grid(plot_2_1 + theme(legend.position="none"),
                   NULL,
                   plot_2_2 + theme(legend.position="none"),
                   NULL,
                   plot_2_3 + theme(legend.position="none"),
                   nrow = 1,
                   ncol = 5,
                   align = "v",
                   axis = "l",
                   labels = c("", "", "", "", ""),
                   rel_widths = c(1,0.02,1,0.02,1))

#row 3
plot_3_1 <- ggplot() +
  geom_line(data = influent_NM, mapping = aes(x = Day,y = Influent), colour = "black", linewidth = 0.4) +
  scale_x_continuous(limits = c(-1,156),
                     breaks = c(1,15,22,30,36,43,57,71,85,99,113,127,142,154),
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 8.5), 
                     breaks = seq(0, 8.0, 2.0), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01)) +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_line(size = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    size = 0.5),
        panel.grid.major = element_blank()) +
  geom_vline(xintercept = c(26,103.5,117,135,143), linewidth = 0.25)

plot_3_2 <- ggplot() +
  geom_line(data = influent_A, mapping = aes(x = Day,y = Influent), colour = "black", linewidth = 0.4) +
  scale_x_continuous(limits = c(-1,156),
                     breaks = c(1,8,15,22,30,36,43,57,64,71,85,99,113,120,127,142,154),
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 8.5), 
                     breaks = seq(0, 8.0, 2.0), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01)) +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_line(size = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    size = 0.5),
        panel.grid.major = element_blank()) +
  geom_vline(xintercept = c(14.5,42.5,70.5,98.5,126.5), linewidth = 0.25)

plot_3_3 <- ggplot() +
  geom_line(data = influent_AM, mapping = aes(x = Day,y = Influent), colour = "black", linewidth = 0.4) +
  scale_x_continuous(limits = c(-1,156),
                     breaks = c(1,4,8,11,14,15,22,25,29,30,36,42,43,57,64,70,71,85,92,98,99,113,120,126,127,142,148,154),
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 8.5), 
                     breaks = seq(0, 8.0, 2.0), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01)) +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_line(size = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    size = 0.5),
        panel.grid.major = element_blank()) +
  geom_vline(xintercept = c(14.5,42.5,70.5,98.5,126.5), linewidth = 0.25)

row_3 <- plot_grid(plot_3_1 + theme(legend.position="none"),
                   NULL,
                   plot_3_2 + theme(legend.position="none"),
                   NULL,
                   plot_3_3 + theme(legend.position="none"),
                   nrow = 1,
                   ncol = 5,
                   align = "v",
                   axis = "l",
                   labels = c("", "", "", "", ""),
                   rel_widths = c(1,0.02,1,0.02,1))


#row 4
plot_4_1 <- ggplot(data = heatmap_NM_O2, mapping = aes(x = Day, y = Height)) +
  geom_rect(mapping = aes(xmin = Day0, xmax = Daymax, ymin = Height0, ymax = Heightf, fill = O2_remov), linewidth = 0.2) +
  # geom_text(mapping = aes(x = Day, y = Height, label = Influent), size = 2.5, angle = 90) +
  scale_fill_gradientn(colours = c("#D6604D", "#F4A582", "#FDDBC7", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3"), limits = c(-100,100), na.value = 'white') +
  scale_x_continuous(breaks = c(1,15,22,30,36,43,57,71,85,99,113,127,142,154),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = c(0,2.5,17.5,32.5,47.5,52.5),
                     expand = c(0,0)) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_line(size = 0.35),
        axis.ticks.y = element_line(size = 0.35),
        axis.text.x	= element_text(angle = 45, hjust = 1),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.position = "right",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        legend.key.size = unit(10, "pt"),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black",
                                    fill = NA,
                                    size = 0.5)) +
  geom_vline(xintercept = c(26,103.5,117,135,143), linewidth = 0.25) +
  geom_hline(yintercept = c(50), linewidth = 0.3, colour = "grey")

plot_4_2 <- ggplot(data = heatmap_A_O2, mapping = aes(x = Day, y = Height)) +
 geom_rect(mapping = aes(xmin = Day0, xmax = Daymax, ymin = Height0, ymax = Heightf, fill = O2_remov), linewidth = 0.2) +
  # geom_text(mapping = aes(x = Day, y = Height, label = Influent), size = 2.5, angle = 90) +
  scale_fill_gradientn(colours = c("#D6604D", "#F4A582", "#FDDBC7", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3"), limits = c(-100,100), na.value = 'white') +
  scale_x_continuous(breaks = c(1,8,15,22,30,36,43,57,64,71,85,99,113,120,127,142,154),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = c(0,2.5,17.5,32.5,47.5,52.5),
                     expand = c(0,0)) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_line(size = 0.35),
        axis.ticks.y = element_line(size = 0.35),
        axis.text.x	= element_text(angle = 45, hjust = 1),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.position = "right",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        legend.key.size = unit(10, "pt"),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black",
                                    fill = NA,
                                    size = 0.5)) +
  geom_vline(xintercept = c(14.5,42.5,70.5,98.5,126.5), linewidth = 0.25) +
  geom_hline(yintercept = c(50), linewidth = 0.3, colour = "grey")

# nudge_x <- c(0,0,0,0,0,
#              0,0,0,0,0,
#              0,0,0,0,0,
#              0,0,0,0,0,
#              -0.6,-0.6,-0.6,-0.6,-0.6,
#              0.6,0.6,0.6,0.6,0.6,
#              0,0,0,0,0,
#              0,0,0,0,0,
#              -0.6,-0.6,-0.6,-0.6,-0.6,
#              0.6,0.6,0.6,0.6,0.6,
#              0,0,0,0,0,
#              -0.6,-0.6,-0.6,-0.6,-0.6,
#              0.6,0.6,0.6,0.6,0.6,
#              0,0,0,0,0,
#              0,0,0,0,0,
#              -0.6,-0.6,-0.6,-0.6,-0.6,
#              0.6,0.6,0.6,0.6,0.6,
#              0,0,0,0,0,
#              0,0,0,0,0,
#              -0.6,-0.6,-0.6,-0.6,-0.6,
#              0.6,0.6,0.6,0.6,0.6,
#              0,0,0,0,0,
#              0,0,0,0,0,
#              -0.6,-0.6,-0.6,-0.6,-0.6,
#              0.6,0.6,0.6,0.6,0.6,
#              0,0,0,0,0,
#              0,0,0,0,0,
#              0,0,0,0,0)

plot_4_3 <- ggplot(data = heatmap_AM_O2, mapping = aes(x = Day, y = Height)) +
  geom_rect(mapping = aes(xmin = Day0, xmax = Daymax, ymin = Height0, ymax = Heightf, fill = O2_remov), linewidth = 0.2) +
  # geom_text(mapping = aes(x = Day, y = Height, label = Influent), size = 2.5, angle = 90, nudge_x = nudge_x) +
  scale_fill_gradientn(colours = c("#D6604D", "#F4A582", "#FDDBC7", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3"), limits = c(-100,100), na.value = 'white') +
  scale_x_continuous(breaks = c(1,4,8,11,14,15,22,25,29,30,36,42,43,57,64,70,71,85,92,98,99,113,120,126,127,142,148,154),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = c(0,2.5,17.5,32.5,47.5,52.5),
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.1)) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_line(size = 0.35),
        axis.ticks.y = element_line(size = 0.35),
        axis.text.x	= element_text(angle = 45, hjust = 1),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.position = "right",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        legend.key.size = unit(10, "pt"),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black",
                                    fill = NA,
                                    size = 0.5)) +
  geom_vline(xintercept = c(14.5,42.5,70.5,98.5,126.5), linewidth = 0.25) +
  geom_hline(yintercept = c(50), linewidth = 0.3, colour = "grey")

row_4 <- plot_grid(plot_4_1 + theme(legend.position="none"),
                   NULL,
                   plot_4_2 + theme(legend.position="none"),
                   NULL,
                   plot_4_3 + theme(legend.position="none"),
                   nrow = 1,
                   ncol = 5,
                   align = "v",
                   axis = "l",
                   labels = c("", "", "", "", ""),
                   rel_widths = c(1,0.02,1,0.02,1))
#row 5
plot_5_1 <- ggplot(data = heatmap_NM_24_D, mapping = aes(x = Day, y = Height)) +
  geom_rect(mapping = aes(xmin = Day0, xmax = Daymax, ymin = Height0, ymax = Heightf, fill = Removal_Efficiency), linewidth = 0.2) +
  # geom_text(mapping = aes(x = Day, y = Height, label = RemovalEf), size = 2.5, angle = 90) +
  scale_fill_gradientn(colours = c("#D6604D", "#F4A582", "#FDDBC7", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3"), limits = c(-100,100), na.value = 'white') +
  scale_x_continuous(breaks = c(1,15,22,30,36,43,57,71,85,99,113,127,142,154),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = c(0,2.5,17.5,32.5,47.5,52.5),
                     expand = c(0,0)) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_line(size = 0.35),
        axis.ticks.y = element_line(size = 0.35),
        axis.text.x	= element_text(angle = 45, hjust = 1),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.position = "right",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        legend.key.size = unit(10, "pt"),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black",
                                    fill = NA,
                                    size = 0.5)) +
  geom_vline(xintercept = c(26,103.5,117,135,143), linewidth = 0.25) +
  geom_hline(yintercept = c(50), linewidth = 0.3, colour = "grey")

plot_5_2 <- ggplot(data = heatmap_A_24_D, mapping = aes(x = Day, y = Height)) +
  geom_rect(mapping = aes(xmin = Day0, xmax = Daymax, ymin = Height0, ymax = Heightf, fill = Removal_Efficiency), linewidth = 0.2) +
  # geom_text(mapping = aes(x = Day, y = Height, label = RemovalEf), size = 2.5, angle = 90) +
  scale_fill_gradientn(colours = c("#D6604D", "#F4A582", "#FDDBC7", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3"), limits = c(-100,100), na.value = 'white') +
  scale_x_continuous(breaks = c(1,8,15,22,30,36,43,57,64,71,85,99,113,120,127,142,154),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = c(0,2.5,17.5,32.5,47.5,52.5),
                     expand = c(0,0)) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_line(size = 0.35),
        axis.ticks.y = element_line(size = 0.35),
        axis.text.x	= element_text(angle = 45, hjust = 1),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.position = "right",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        legend.key.size = unit(10, "pt"),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black",
                                    fill = NA,
                                    size = 0.5)) +
  geom_vline(xintercept = c(14.5,42.5,70.5,98.5,126.5), linewidth = 0.25) +
  geom_hline(yintercept = c(50), linewidth = 0.3, colour = "grey")

plot_5_3 <- ggplot(data = heatmap_AM_24_D, mapping = aes(x = Day, y = Height)) +
  geom_rect(mapping = aes(xmin = Day0, xmax = Daymax, ymin = Height0, ymax = Heightf, fill = Removal_Efficiency), linewidth = 0.2) +
  # geom_text(mapping = aes(x = Day, y = Height, label = RemovalEf), size = 2.5, angle = 90, nudge_x = nudge_x) +
  scale_fill_gradientn(colours = c("#D6604D", "#F4A582", "#FDDBC7", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3"), limits = c(-100,100), na.value = 'white') +
  scale_x_continuous(breaks = c(1,4,8,11,14,15,22,25,29,30,36,42,43,57,64,70,71,85,92,98,99,113,120,126,127,142,148,154),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = c(0,2.5,17.5,32.5,47.5,52.5),
                     expand = c(0,0)) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_line(size = 0.35),
        axis.ticks.y = element_line(size = 0.35),
        axis.text.x	= element_text(angle = 45, hjust = 1),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.position = "right",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        legend.key.size = unit(10, "pt"),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black",
                                    fill = NA,
                                    size = 0.5)) +
  geom_vline(xintercept = c(14.5,42.5,70.5,98.5,126.5), linewidth = 0.25) +
  geom_hline(yintercept = c(50), linewidth = 0.3, colour = "grey")

row_5 <- plot_grid(plot_5_1 + theme(legend.position="none"),
                   NULL,
                   plot_5_2 + theme(legend.position="none"),
                   NULL,
                   plot_5_3 + theme(legend.position="none"),
                   nrow = 1,
                   ncol = 5,
                   align = "v",
                   axis = "l",
                   labels = c("", "", "", "", ""),
                   rel_widths = c(1,0.02,1,0.02,1))

#row 6
plot_6_1 <- ggplot(data = heatmap_NM_MCPP, mapping = aes(x = Day, y = Height)) +
  geom_rect(mapping = aes(xmin = Day0, xmax = Daymax, ymin = Height0, ymax = Heightf, fill = Removal_Efficiency), linewidth = 0.2) +
  # geom_text(mapping = aes(x = Day, y = Height, label = RemovalEf), size = 2.5, angle = 90) +
  scale_fill_gradientn(colours = c("#D6604D", "#F4A582", "#FDDBC7", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3"), limits = c(-100,100), na.value = 'white') +
  scale_x_continuous(breaks = c(1,15,22,30,36,43,57,71,85,99,113,127,142,154),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = c(0,2.5,17.5,32.5,47.5,52.5),
                     expand = c(0,0)) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_line(size = 0.35),
        axis.ticks.y = element_line(size = 0.35),
        axis.text.x	= element_text(angle = 45, hjust = 1),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.position = "right",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        legend.key.size = unit(10, "pt"),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black",
                                    fill = NA,
                                    size = 0.5)) +
  geom_vline(xintercept = c(26,103.5,117,135,143), linewidth = 0.25) +
  geom_hline(yintercept = c(50), linewidth = 0.3, colour = "grey")

plot_6_2 <- ggplot(data = heatmap_A_MCPP, mapping = aes(x = Day, y = Height)) +
  geom_rect(mapping = aes(xmin = Day0, xmax = Daymax, ymin = Height0, ymax = Heightf, fill = Removal_Efficiency), linewidth = 0.2) +
  # geom_text(mapping = aes(x = Day, y = Height, label = RemovalEf), size = 2.5, angle = 90) +
  scale_fill_gradientn(colours = c("#D6604D", "#F4A582", "#FDDBC7", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3"), limits = c(-100,100), na.value = 'white') +
  scale_x_continuous(breaks = c(1,8,15,22,30,36,43,57,64,71,85,99,113,120,127,142,154),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = c(0,2.5,17.5,32.5,47.5,52.5),
                     expand = c(0,0)) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_line(size = 0.35),
        axis.ticks.y = element_line(size = 0.35),
        axis.text.x	= element_text(angle = 45, hjust = 1),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.position = "right",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        legend.key.size = unit(10, "pt"),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black",
                                    fill = NA,
                                    size = 0.5)) +
  geom_vline(xintercept = c(14.5,42.5,70.5,98.5,126.5), linewidth = 0.25) +
  geom_hline(yintercept = c(50), linewidth = 0.3, colour = "grey")

plot_6_3 <- ggplot(data = heatmap_AM_MCPP, mapping = aes(x = Day, y = Height)) +
  geom_rect(mapping = aes(xmin = Day0, xmax = Daymax, ymin = Height0, ymax = Heightf, fill = Removal_Efficiency), linewidth = 0.2) +
  # geom_text(mapping = aes(x = Day, y = Height, label = RemovalEf), size = 2.5, angle = 90, nudge_x = nudge_x) +
  scale_fill_gradientn(colours = c("#D6604D", "#F4A582", "#FDDBC7", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3"), limits = c(-100,100), na.value = 'white') +
  scale_x_continuous(breaks = c(1,4,8,11,14,15,22,25,29,30,36,42,43,57,64,70,71,85,92,98,99,113,120,126,127,142,148,154),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = c(0,2.5,17.5,32.5,47.5,52.5),
                     expand = c(0,0)) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks.x = element_line(size = 0.35),
        axis.ticks.y = element_line(size = 0.35),
        axis.text.x	= element_text(angle = 45, hjust = 1),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 9),
        legend.title = element_text(size = 10),
        legend.position = "right",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        legend.key.size = unit(20, "pt"),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black",
                                    fill = NA,
                                    size = 0.5)) +
  geom_vline(xintercept = c(14.5,42.5,70.5,98.5,126.5), linewidth = 0.25) +
  geom_hline(yintercept = c(50), linewidth = 0.3, colour = "grey")

row_6 <- plot_grid(plot_6_1 + theme(legend.position="none"),
                   NULL,
                   plot_6_2 + theme(legend.position="none"),
                   NULL,
                   plot_6_3 + theme(legend.position="none"),
                   nrow = 1,
                   ncol = 5,
                   align = "v",
                   axis = "l",
                   labels = c("", "", "", "", ""),
                   rel_widths = c(1,0.02,1,0.02,1))

#plot

legend <- get_legend(plot_6_3)

plot_2 <- plot_grid (row_1, row_2, row_3, row_4, row_5, row_6, nrow = 6, rel_heights = c(0.2,0.15,0.4,1,1,1))

plot_2_final <- plot_grid (plot_2,
                           legend, ncol = 2, rel_widths = c(6,0.5))

plot_2_final
  
ggsave("C:/Users/Rita/Documents/R/amendment_micropollutant_biodegradation_aquifer/figures/Figure4_2.pdf", width = 20, height = 8)
```

**Figure 2**. Influent oxygen concentration, oxygen consumption, and 2,4-D and MCPP removal efficiency in time per heigh in columns: A) Microaerobic cycles without electron donor amendment; B) Aerobic cycles with electron donor amendment; and C) Aerobic cycles with electron donor amendment.<br>

# Supplementary material

## 3.1. Figure S2

```{r Figure S2, message=F, echo=T, eval=T, warning=T, include=T, cache=F, fig.width=8, fig.height=8}
breaks_1 <- c("2.5", "17.5", "32.5", "47.5")
valuesfill_1 <- c("white", "white", "white", "white")
valuesshape_1 <- c(21, 22, 24, 23)
valuesline_1 <- c(1, 1, 1, 1)

redox_cond <- c("Nitrate", "Microaer", "Nitrate", "Microaer", "Nitrate", "Microaer")
valuesfill_2 <- c("#FFFFE5", "#D9F0A3", "#FFFFE5", "#D9F0A3", "#FFFFE5", "#D9F0A3")
valuesalpha_3 <- c(0.6,0.6,0.6,0.6,0.6,0.6)
aerate_1 <- data.frame(x1=c(0,26,103.5,117,135,143), x2=c(26,103.5,117,135,143,155), y1=c(-Inf,-Inf,-Inf,-Inf,-Inf,-Inf), y2=c(Inf,Inf,Inf,Inf,Inf,Inf))

breaks_2 <- c("0", "2.5", "17.5", "32.5", "47.5", "50")
valuesfill_7 <- c("black", "white", "white", "white", "white", "white")
valuesshape_4 <- c(32, 21, 22, 24, 23, 4)
valuesline_4 <- c(1, 1, 1, 1, 1, 1)

valuesshape_5 <- c(32, 21, 22, 24, 23, 4)

breaks_6 <- c("HUM", "BIOPOL", "LMWA", "LMWN", "HOC", "NH4")
valuesfill_8 <- c("#B2182B", "#D6604D", "#F4A582", "#FDDBC7", "#F7F7F7", "#D1E5F0")

# Oxygen
plot_nitrate_red_microaer_O2 <- ggplot() +
 geom_rect(data=aerate_1, 
           mapping=aes(xmin=x1, 
                       xmax=x2, 
                       ymin = y1, 
                       ymax = y2,
                       fill= redox_cond,
                       alpha = redox_cond)) +
  scale_fill_manual (breaks = redox_cond, 
                     values = valuesfill_2) +
  scale_alpha_manual(breaks = redox_cond, 
                     values = valuesalpha_3) +
  new_scale("fill") +
  geom_line(data = nitrate_red_microaer_O2, 
            mapping = aes(x = Day,
                          y = O2_mg_L,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = nitrate_red_microaer_O2,
             mapping = aes(x = Day,
                          y = O2_mg_L,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_1,
                     values = valuesshape_1) +
  scale_fill_manual (breaks = breaks_1, 
                     values = valuesfill_1) +
  scale_linetype_manual(breaks = breaks_1, 
                        values = valuesline_1) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.06, 1.81), 
                     breaks = seq(0.0, 1.75, 0.250), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(O[2]~(mg/L))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank())

# 2,4-D

plot_nitrate_red_microaer_24_D <- ggplot() +
 geom_rect(data=aerate_1, 
           mapping=aes(xmin=x1, 
                       xmax=x2, 
                       ymin = y1, 
                       ymax = y2,
                       fill= redox_cond,
                       alpha = redox_cond)) +
  scale_fill_manual (breaks = redox_cond, 
                     values = valuesfill_2) +
  scale_alpha_manual(breaks = redox_cond, 
                     values = valuesalpha_3) +
  new_scale("fill") +
  geom_line(data = nitrate_red_microaer_24_D, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = nitrate_red_microaer_24_D,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_4) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression("2,4-D"~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank()) +
  geom_hline(yintercept = 1, size = 0.4)

# MCPP

plot_nitrate_red_microaer_MCPP <- ggplot() +
 geom_rect(data=aerate_1, 
           mapping=aes(xmin=x1, 
                       xmax=x2, 
                       ymin = y1, 
                       ymax = y2,
                       fill= redox_cond,
                       alpha = redox_cond)) +
  scale_fill_manual (breaks = redox_cond, 
                     values = valuesfill_2) +
  scale_alpha_manual(breaks = redox_cond, 
                     values = valuesalpha_3) +
  new_scale("fill") +
  geom_line(data = nitrate_red_microaer_MCPP, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = nitrate_red_microaer_MCPP,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_4) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(MCPP~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank()) +
  geom_hline(yintercept = 1, size = 0.4)

# Nitrate

plot_nitrate_red_microaer_NO3 <- ggplot() +
 geom_rect(data=aerate_1, 
           mapping=aes(xmin=x1, 
                       xmax=x2, 
                       ymin = y1, 
                       ymax = y2,
                       fill= redox_cond,
                       alpha = redox_cond)) +
  scale_fill_manual (breaks = redox_cond, 
                     values = valuesfill_2) +
  scale_alpha_manual(breaks = redox_cond, 
                     values = valuesalpha_3) +
  new_scale("fill") +
  geom_line(data = nitrate_red_microaer_NO3, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = nitrate_red_microaer_NO3,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_5) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(NO[3]^{"-"}~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank())

# Electron donor

plot_nitrate_red_microaer_donor <- ggplot() +
  geom_bar(data = nitrate_red_microaer_donor, mapping = aes(x = as.factor(Height),
                                          y = concentration,
                                          col = compound,
                                          fill = compound),
           stat = "identity",
           colour = "black",
           width = 0.8,
           linewidth = 0.3) +
  scale_fill_manual (breaks = breaks_6, 
                     values = valuesfill_8) +
  scale_x_discrete(name = "Time (day) | Redox condition | Height (cm)") +
  scale_y_continuous(limits = c(-0.14, 4.14), 
                     breaks = seq(0, 4, 0.5), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(DOC~(mg-C/L))) +
  facet_nested(~ Day + Redox_condition_2_50) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.text.x	= element_text(angle = 60, hjust = 1),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(0, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.25),
        panel.grid.major.y = element_line(colour = "grey87",
                                        linewidth = 0.15))

legend_S2_1 <- get_legend(plot_nitrate_red_microaer_MCPP)

plot_S2_1 <- plot_grid (plot_nitrate_red_microaer_O2 + theme(legend.position="none"), 
                        plot_nitrate_red_microaer_NO3 + theme(legend.position="none"), 
                        plot_nitrate_red_microaer_24_D + theme(legend.position="none"), 
                        plot_nitrate_red_microaer_MCPP + theme(legend.position="none"),
                        ncol = 2, 
                        nrow = 2)

plot_S2_2 <- plot_grid (plot_S2_1,
                        legend_S2_1, nrow = 2, rel_heights = c(6,0.5))

plot_S2_final <- plot_grid(plot_S2_2,
                           NULL,
                           plot_nitrate_red_microaer_donor,
                           nrow = 3,
                           rel_heights = c(2,0.05,1.2),
                           labels = c("A", "", "B"))

plot_S2_final

ggsave("C:/Users/Rita/Documents/R/amendment_micropollutant_biodegradation_aquifer/figures/Figure4_S2.pdf", width = 8, height = 8)
```

**Figure S2**. Microaerobic cycles without electron donor amendment column: A) Oxygen, nitrate, 2,4-D, and MCPP concentration in time at each height; B) DOC fractions per height at different time points.<br>

## 3.2. Figure S3

```{r Figure S3, message=F, echo=T, eval=T, warning=T, include=T, cache=F, fig.width=8, fig.height=8}
DOC <- c("H", "H_D", "D", "D_A", "A", "NH4")
valuesfill_3 <- c("#B2182B", "#D6604D", "#F4A582", "#FDDBC7", "#F7F7F7", "#D1E5F0")
valuesalpha_1 <- c(0.3,0.3,0.3,0.3,0.3,0.3)
DOC_1 <- data.frame(x3=c(0,14.5,42.5,70.5,98.5,126.5), x4=c(14.5,42.5,70.5,98.5,126.5,155), y3=c(-Inf,-Inf,-Inf,-Inf,-Inf,-Inf), y4=c(Inf,Inf,Inf,Inf,Inf,Inf))

# Oxygen
plot_nitrate_red_O2 <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  geom_line(data = nitrate_red_O2, 
            mapping = aes(x = Day,
                          y = O2_mg_L,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = nitrate_red_O2,
             mapping = aes(x = Day,
                          y = O2_mg_L,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_1,
                     values = valuesshape_1) +
  scale_fill_manual (breaks = breaks_1, 
                     values = valuesfill_1) +
  scale_linetype_manual(breaks = breaks_1, 
                        values = valuesline_1) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.08, 2.18), 
                     breaks = seq(0.0, 2.1, 0.30), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(O[2]~(mg/L))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank())

#2,4-D

plot_nitrate_red_24_D <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  geom_line(data = nitrate_red_24_D, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = nitrate_red_24_D,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_4) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression("2,4-D"~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank()) +
  geom_hline(yintercept = 1, size = 0.4)

# MCPP

plot_nitrate_red_MCPP <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  geom_line(data = nitrate_red_MCPP, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = nitrate_red_MCPP,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_4) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(MCPP~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank()) +
  geom_hline(yintercept = 1, size = 0.4)

# Nitrate

plot_nitrate_red_NO3 <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  geom_line(data = nitrate_red_NO3, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = nitrate_red_NO3,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_5) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(NO[3]^{"-"}~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank())

# Electron donor

plot_nitrate_red_donor <- ggplot() +
  geom_bar(data = nitrate_red_donor, mapping = aes(x = as.factor(Height),
                                          y = concentration,
                                          col = compound,
                                          fill = compound),
           stat = "identity",
           colour = "black",
           width = 0.7,
           linewidth = 0.3) +
  scale_fill_manual (breaks = breaks_6, 
                     values = valuesfill_8) +
  scale_x_discrete(name = "Time (day) | Electron donor | Height (cm)") +
  scale_y_continuous(limits = c(-2.14, 62.14), 
                     breaks = seq(0, 60, 10),
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(DOC~(mg-C/L)~"|"~NH[4]^{"+"}~(mg/L))) +
  facet_nested(~ DOM + Day) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.text.x	= element_text(angle = 60, hjust = 1),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(0, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.25),
        panel.grid.major.y = element_line(colour = "grey87",
                                        linewidth = 0.15))

legend_S3_1 <- get_legend(plot_nitrate_red_MCPP)

plot_S3_1 <- plot_grid (plot_nitrate_red_O2 + theme(legend.position="none"), 
                        plot_nitrate_red_NO3 + theme(legend.position="none"), 
                        plot_nitrate_red_24_D + theme(legend.position="none"), 
                        plot_nitrate_red_MCPP + theme(legend.position="none"),
                        ncol = 2, nrow = 2)

plot_S3_2 <- plot_grid (plot_S3_1,
                        legend_S3_1, nrow = 2, rel_heights = c(6,0.5))

plot_S3_final <- plot_grid(plot_S3_2,
                           NULL,
                           plot_nitrate_red_donor,
                           nrow = 3,
                           rel_heights = c(2,0.05,1.2),
                           labels = c("A", "", "B"))

plot_S3_final

ggsave("C:/Users/Rita/Documents/R/amendment_micropollutant_biodegradation_aquifer/figures/Figure4_S3.pdf", width = 8, height = 8)
```

**Figure S3**. Nitrate reducing with electron donor amendment column: A) Oxygen, nitrate, 2,4-D, and MCPP concentration in time at each height (oxygen peaks correspond to days in which the electron donor syringe was refilled); B) DOC fractions per height at different time points.<br>

## 3.3. Figure S4

```{r Figure S4, message=F, echo=T, eval=T, warning=T, include=T, cache=F, fig.width=8, fig.height=8}
breaks_4 <- c("0", "2.5", "6.25", "10", "13.75", "17.5", "25", "32.5", "47.5")
valuesfill_4 <- c("black", "white", "white", "white", "white", "white", "white", "white", "white")
valuesshape_2 <- c(32, 21, 21, 21, 21, 22, 22, 24, 23)
valuesline_2 <- c(1, 1, 2, 4, 3, 1, 2, 1, 1)

#Oxygen

plot_aerob_O2 <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  geom_line(data = aerob_O2, 
            mapping = aes(x = Day,
                          y = O2_mg_L,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = aerob_O2,
             mapping = aes(x = Day,
                          y = O2_mg_L,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_4,
                     values = valuesshape_2) +
  scale_fill_manual (breaks = breaks_4, 
                     values = valuesfill_4) +
  scale_linetype_manual(breaks = breaks_4, 
                        values = valuesline_2) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.315, 9.065), 
                     breaks = seq(0, 8.75, 1.25),
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(O[2]~(mg/L))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank())

# 2,4-D

plot_aerob_24_D <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  geom_line(data = aerob_24_D, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = aerob_24_D,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_4) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression("2,4-D"~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank()) +
  geom_segment(aes(x=0,xend=64,y=1,yend=1), size = 0.4)

# MCPP

plot_aerob_MCPP <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  geom_line(data = aerob_MCPP, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = aerob_MCPP,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_4) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2),
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(MCPP~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank()) +
  geom_segment(aes(x=0,xend=71,y=1,yend=1), size = 0.4)

# Nitrate

plot_aerob_NO3 <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  geom_line(data = aerob_NO3, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = aerob_NO3,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_5) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2),
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(NO[3]^{"-"}~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank())

# Electron donor

plot_aerob_donor <- ggplot() +
  geom_bar(data = aerob_donor, mapping = aes(x = as.factor(Height),
                                          y = concentration,
                                          col = compound,
                                          fill = compound),
           stat = "identity",
           colour = "black",
           width = 0.7,
           linewidth = 0.3) +
  scale_fill_manual (breaks = breaks_6, 
                     values = valuesfill_8) +
  scale_x_discrete(name = "Time (day) | Electron donor | Height (cm)") +
  scale_y_continuous(limits = c(-2.14, 62.14), 
                     breaks = seq(0, 60, 10), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(DOC~(mg-C/L)~"|"~NH[4]^{"+"}~(mg/L))) +
  facet_nested(~ DOM + Day) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.text.x	= element_text(angle = 60, hjust = 1),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(0, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.25),
        panel.grid.major.y = element_line(colour = "grey87",
                                        linewidth = 0.15))

legend_S4_1 <- get_legend(plot_aerob_O2)

plot_S4_1 <- plot_grid (plot_aerob_O2 + theme(legend.position="none"), 
                        plot_aerob_NO3 + theme(legend.position="none"), 
                        plot_aerob_24_D + theme(legend.position="none"), 
                        plot_aerob_MCPP + theme(legend.position="none"),
                        ncol = 2, nrow = 2)

plot_S4_2 <- plot_grid (plot_S4_1,
                        legend_S4_1, nrow = 2, rel_heights = c(6,0.5))

plot_S4_final <- plot_grid(plot_S4_2,
                           NULL,
                           plot_aerob_donor,
                           nrow = 3,
                           rel_heights = c(2,0.05,1.2),
                           labels = c("A", "", "B"))

plot_S4_final

ggsave("C:/Users/Rita/Documents/R/amendment_micropollutant_biodegradation_aquifer/figures/Figure4_S4.pdf", width = 8, height = 8)
```

**Figure S4**. Aerobic with electron donor amendment column: A) Oxygen, nitrate, 2,4-D, and MCPP concentration in time at each height (from days 64 to 94 and days 113 to 135, 2,4-D and MCPP were consumed before the influent chamber); B) DOC fractions per height at different time points.<br>

## 2.4. Figure S5

```{r Figure S5, message=F, echo=T, eval=T, warning=T, include=T, cache=F, fig.width=8, fig.height=8}
breaks_5 <- c("0", "2.5", "17.5", "32.5", "47.5")
valuesfill_5 <- c("black", "white", "white", "white", "white")
valuesshape_3 <- c(32, 21, 22, 24, 23)
valuesline_3 <- c(1, 1, 1, 1, 1)

aeration_on <- c("On","On","On","On","On","On","On","On","On","On","On")
valuesfill_6 <- c("black","black","black","black","black","black","black","black","black","black","black")
valuesalpha_2 <- c(0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1)
  
aerate_on_off_1 <- data.frame(x5=c(1,15,30,43,57,71,85,99,113,127,142), x6=c(3.27,16.25,31.25,45.26,59.27,73.27,87.21,101.26,114.93,129.15,144.25), y5=c(-Inf,-Inf,-Inf,-Inf,-Inf,-Inf,-Inf,-Inf,-Inf,-Inf,-Inf), y6=c(Inf,Inf,Inf,Inf,Inf,Inf,Inf,Inf,Inf,Inf,Inf))

aerate_on_off_2 <- c(1,3.27,15,16.25,30,31.25,43,45.26,57,59.27,71,73.27,85,87.21,99,101.26,113,114.93,127,129.15,142,144.25)

# Oxygen

plot_aerob_microaerob_O2 <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  new_scale("alpha") +
  geom_vline(xintercept = aerate_on_off_2, size = 0.25, linetype = 3) +
  geom_rect(data=aerate_on_off_1, 
           mapping=aes(xmin=x5, 
                       xmax=x6, 
                       ymin = y5, 
                       ymax = y6,
                       fill = aeration_on,
                       alpha = aeration_on)) +
  scale_fill_manual (breaks = aeration_on, 
                     values = valuesfill_6) +
  scale_alpha_manual(breaks = aeration_on, 
                     values = valuesalpha_2) +
  new_scale("fill") +
  geom_line(data = aerob_microaerob_O2, 
            mapping = aes(x = Day,
                          y = O2_mg_L,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = aerob_microaerob_O2,
             mapping = aes(x = Day,
                          y = O2_mg_L,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_5,
                     values = valuesshape_3) +
  scale_fill_manual (breaks = breaks_5, 
                     values = valuesfill_5) +
  scale_linetype_manual(breaks = breaks_5, 
                        values = valuesline_3) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.315, 9.065), 
                     breaks = seq(0, 8.75, 1.25), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(O[2]~(mg/L))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank())

# 2,4-D

plot_aerob_microaerob_24_D <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  new_scale("alpha") +
  geom_vline(xintercept = aerate_on_off_2, size = 0.25, linetype = 3) +
  geom_rect(data=aerate_on_off_1, 
           mapping=aes(xmin=x5, 
                       xmax=x6, 
                       ymin = y5, 
                       ymax = y6,
                       fill = aeration_on,
                       alpha = aeration_on)) +
  scale_fill_manual (breaks = aeration_on, 
                     values = valuesfill_6) +
  scale_alpha_manual(breaks = aeration_on, 
                     values = valuesalpha_2) +
  new_scale("fill") +
  geom_line(data = aerob_microaerob_24_D, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = aerob_microaerob_24_D,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_4) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression("2,4-D"~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank()) +
  geom_segment(aes(x=0,xend=148,y=1,yend=1), size = 0.4)

# MCPP

plot_aerob_microaerob_MCPP <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  new_scale("alpha") +
  geom_vline(xintercept = aerate_on_off_2, size = 0.25, linetype = 3) +
  geom_rect(data=aerate_on_off_1, 
           mapping=aes(xmin=x5, 
                       xmax=x6, 
                       ymin = y5, 
                       ymax = y6,
                       fill = aeration_on,
                       alpha = aeration_on)) +
  scale_fill_manual (breaks = aeration_on, 
                     values = valuesfill_6) +
  scale_alpha_manual(breaks = aeration_on, 
                     values = valuesalpha_2) +
  new_scale("fill") +
  geom_line(data = aerob_microaerob_MCPP, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = aerob_microaerob_MCPP,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_4) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2),  
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(MCPP~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank()) +
  geom_hline(yintercept = 1, size = 0.4)

# Nitrate

plot_aerob_microaerob_NO3 <- ggplot() +
 geom_rect(data=DOC_1, 
           mapping=aes(xmin=x3, 
                       xmax=x4, 
                       ymin = y3, 
                       ymax = y4,
                       fill = DOC,
                       alpha = DOC)) +
  scale_fill_manual (breaks = DOC, 
                     values = valuesfill_3) +
  scale_alpha_manual(breaks = DOC, 
                     values = valuesalpha_1) +
  new_scale("fill") +
  new_scale("alpha") +
  geom_vline(xintercept = aerate_on_off_2, size = 0.25, linetype = 3) +
  geom_rect(data=aerate_on_off_1, 
           mapping=aes(xmin=x5, 
                       xmax=x6, 
                       ymin = y5, 
                       ymax = y6,
                       fill = aeration_on,
                       alpha = aeration_on)) +
  scale_fill_manual (breaks = aeration_on, 
                     values = valuesfill_6) +
  scale_alpha_manual(breaks = aeration_on, 
                     values = valuesalpha_2) +
  new_scale("fill") +
  geom_line(data = aerob_microaerob_NO3, 
            mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          linetype = Height),
            colour = "black", 
            linewidth = 0.4) +
  geom_point(data = aerob_microaerob_NO3,
             mapping = aes(x = Day,
                          y = concentration,
                          colour = Height,
                          fill = Height,
                          shape = Height),
             colour = "black") +
  scale_shape_manual(breaks = breaks_2,
                     values = valuesshape_4) +
  scale_fill_manual (breaks = breaks_2, 
                     values = valuesfill_7) +
  scale_linetype_manual(breaks = breaks_2, 
                        values = valuesline_4) +
  scale_x_continuous(limits = c(0, 155),
                     breaks = seq(0, 155, 15),
                     expand = c(0,0),
                     name = "Time (day)") +
  scale_y_continuous(limits = c(-0.05, 1.45), 
                     breaks = seq(0, 1.4, 0.2), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(NO[3]^{"-"}~(C/C[0]))) +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(5, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.5),
        panel.grid.major.y = element_line(colour = "grey65",
                                        linewidth = 0.15),
        panel.grid.major.x = element_blank())

# Electron donor

plot_aerob_microaerob_donor <- ggplot() +
  geom_bar(data = aerob_microaerob_donor, mapping = aes(x = as.factor(Height),
                                          y = concentration,
                                          col = compound,
                                          fill = compound),
           stat = "identity",
           colour = "black",
           width = 0.7,
           linewidth = 0.3) +
  scale_fill_manual (breaks = breaks_6, 
                     values = valuesfill_8) +
  scale_x_discrete(name = "Time (day) | Electron donor | Height (cm)") +
  scale_y_continuous(limits = c(-2.14, 62.14), 
                     breaks = seq(0, 60, 10), 
                     expand = c(0,0),
                     labels = label_number(accuracy = 0.01),
                     name = expression(DOC~(mg-C/L)~"|"~NH[4]^{"+"}~(mg/L))) +
  facet_nested(~ DOM + Day + Aeration) +
  theme_classic() +
  theme_classic() +
  theme(axis.text = element_text(size = 7, colour = "black"),
        axis.text.x	= element_text(angle = 60, hjust = 1),
        axis.ticks = element_line(linewidth = 0.25),
        axis.title = element_text(size = 9),
        axis.title.x = element_text(margin = margin(t = 7)),
        axis.title.y = element_text(margin = margin(r = 7)),
        axis.line = element_blank(),
        legend.text	= element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.key.width = unit(12, "pt"),
        legend.key.height = unit(10, "pt"),
        legend.position ="bottom",
        strip.text = element_text(size = 8),
        strip.background = element_blank(),
        panel.spacing = unit(0, "pt"),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, 
                                    linewidth = 0.25),
        panel.grid.major.y = element_line(colour = "grey87",
                                        linewidth = 0.15))

legend_S5_1 <- get_legend(plot_aerob_microaerob_O2)

plot_S5_1 <- plot_grid (plot_aerob_microaerob_O2 + theme(legend.position="none"), 
                        plot_aerob_microaerob_NO3 + theme(legend.position="none"), 
                        plot_aerob_microaerob_24_D + theme(legend.position="none"), 
                        plot_aerob_microaerob_MCPP + theme(legend.position="none"),
                        ncol = 2, nrow = 2)

plot_S5_2 <- plot_grid (plot_S5_1,
                        legend_S5_1, nrow = 2, rel_heights = c(6,0.5))

plot_S5_final <- plot_grid(plot_S5_2,
                           NULL,
                           plot_aerob_microaerob_donor,
                           nrow = 3,
                           rel_heights = c(2,0.05,1.2),
                           labels = c("A", "", "B"))

plot_S5_final

ggsave("C:/Users/Rita/Documents/R/amendment_micropollutant_biodegradation_aquifer/figures/Figure4_S5.pdf", width = 8, height = 8)
```

**Figure S5**. Aerobic cycles with electron donor amendment column: A) Oxygen, nitrate, 2,4-D, and MCPP concentration in time at each height (from days 148 to 154, 2,4-D was consumed before the influent chamber); B) DOC fractions per height at different time points.<br>

# 3. Color pallet

```{r color pallet, message=F, echo=T, eval=T, warning=T, include=T, cache=F, fig.width=6, fig.height=3}
display.brewer.pal(n = 11, name = "RdBu")
brewer.pal(n = 11, name = "RdBu")

display.brewer.pal(n = 9, name = "YlGn")
brewer.pal(n = 9, name = "YlGn")
```